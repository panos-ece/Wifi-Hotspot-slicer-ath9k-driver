Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ar5008_phy.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ar5008_phy.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ar9003_calib.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ar9003_calib.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ar9003_eeprom.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ar9003_eeprom.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ar9003_hw.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ar9003_hw.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ar9003_paprd.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ar9003_paprd.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ar9003_phy.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ar9003_phy.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k_common.ko and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k_common.ko differ
diff -ruN backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k_common.mod.c backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k_common.mod.c
--- backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k_common.mod.c	2021-03-24 03:17:10.000000000 -0400
+++ backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k_common.mod.c	2021-09-22 06:21:52.000000000 -0400
@@ -28,4 +28,4 @@
 "depends=compat,cfg80211,ath,ath9k_hw";
 
 
-MODULE_INFO(srcversion, "30B41B6DA530836BAD551B0");
+MODULE_INFO(srcversion, "F02BCF7987142DA41A78FC3");
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k_common.mod.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k_common.mod.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k_htc.ko and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k_htc.ko differ
diff -ruN backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k_htc.mod.c backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k_htc.mod.c
--- backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k_htc.mod.c	2021-03-24 03:17:10.000000000 -0400
+++ backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k_htc.mod.c	2021-09-22 06:21:52.000000000 -0400
@@ -56,4 +56,4 @@
 MODULE_ALIAS("usb:v0930p0A08d*dc*dsc*dp*ic*isc*ip*in*");
 MODULE_ALIAS("usb:v0CF3p20FFd*dc*dsc*dp*ic*isc*ip*in*");
 
-MODULE_INFO(srcversion, "D19CCBC4391DD7F67DE656F");
+MODULE_INFO(srcversion, "1847A3008D9FEE61B4DD5AE");
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k_htc.mod.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k_htc.mod.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k_htc.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k_htc.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k_hw.ko and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k_hw.ko differ
diff -ruN backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k_hw.mod.c backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k_hw.mod.c
--- backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k_hw.mod.c	2021-03-24 03:17:10.000000000 -0400
+++ backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k_hw.mod.c	2021-09-22 06:21:52.000000000 -0400
@@ -24,4 +24,4 @@
 "depends=ath";
 
 
-MODULE_INFO(srcversion, "47EFC3B776019841E1988C6");
+MODULE_INFO(srcversion, "8207034A7488A1459ECF84B");
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k_hw.mod.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k_hw.mod.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k_hw.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k_hw.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k.ko and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k.ko differ
diff -ruN backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k.mod.c backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k.mod.c
--- backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k.mod.c	2021-03-24 03:17:10.000000000 -0400
+++ backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k.mod.c	2021-09-22 06:21:52.000000000 -0400
@@ -179,4 +179,4 @@
 MODULE_ALIAS("pci:v0000168Cd00000036sv00001028sd0000020Ebc*sc*i*");
 MODULE_ALIAS("pci:v0000168Cd00000036sv*sd*bc*sc*i*");
 
-MODULE_INFO(srcversion, "EFC25951A6FDD1E78CDDCDD");
+MODULE_INFO(srcversion, "3A1C51CF2A9D4F764C2E5AD");
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k.mod.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k.mod.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/ath9k.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/debug.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/debug.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/eeprom_4k.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/eeprom_4k.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/eeprom_9287.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/eeprom_9287.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/eeprom_def.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/eeprom_def.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/eeprom.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/eeprom.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/htc_drv_init.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/htc_drv_init.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/hw.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/hw.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/init.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/init.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/link.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/link.o differ
diff -ruN backports-5.3.6-1/drivers/net/wireless/ath/ath9k/mac.c backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/mac.c
--- backports-5.3.6-1/drivers/net/wireless/ath/ath9k/mac.c	2019-10-11 19:05:52.000000000 -0400
+++ backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/mac.c	2021-09-22 06:20:30.000000000 -0400
@@ -17,6 +17,8 @@
 #include "hw.h"
 #include "hw-ops.h"
 #include <linux/export.h>
+#include <linux/kmod.h>
+
 
 static void ath9k_hw_set_txq_interrupts(struct ath_hw *ah,
 					struct ath9k_tx_queue_info *qi)
@@ -392,6 +394,8 @@
 		  SM(qi->tqi_cwmax, AR_D_LCL_IFS_CWMAX) |
 		  SM(qi->tqi_aifs, AR_D_LCL_IFS_AIFS));
 
+	printk("regwrite aifs is %d\n",qi->tqi_aifs);
+
 	REG_WRITE(ah, AR_DRETRY_LIMIT(q),
 		  SM(INIT_SSH_RETRY, AR_D_RETRY_LIMIT_STA_SH) |
 		  SM(INIT_SLG_RETRY, AR_D_RETRY_LIMIT_STA_LG) |
@@ -521,6 +525,176 @@
 }
 EXPORT_SYMBOL(ath9k_hw_resettxqueue);
 
+
+bool ath9k_hw_resettxqueue_helper(struct ath_hw *ah, u32 q,int aifs)
+{
+	struct ath_common *common = ath9k_hw_common(ah);
+	struct ath9k_tx_queue_info *qi;
+	u32 cwMin, chanCwMin, value;
+
+	qi = &ah->txq[q];
+	if (qi->tqi_type == ATH9K_TX_QUEUE_INACTIVE) {
+		ath_dbg(common, QUEUE, "Reset TXQ, inactive queue: %u\n", q);
+		return true;
+	}
+
+	ath_dbg(common, QUEUE, "Reset TX queue: %u\n", q);
+
+	if (qi->tqi_cwmin == ATH9K_TXQ_USEDEFAULT) {
+		chanCwMin = INIT_CWMIN;
+
+		for (cwMin = 1; cwMin < chanCwMin; cwMin = (cwMin << 1) | 1);
+	} else
+		cwMin = qi->tqi_cwmin;
+
+	ENABLE_REGWRITE_BUFFER(ah);
+
+    if(aifs>=0 && aifs<=255){
+    	qi->tqi_aifs = (int)aifs;
+    }
+    else{
+    	printk("wrong aifs range\n");
+    }
+
+    printk("new aifs is %d\n",qi->tqi_aifs);
+
+	REG_WRITE(ah, AR_DLCL_IFS(q),
+		  SM(cwMin, AR_D_LCL_IFS_CWMIN) |
+		  SM(qi->tqi_cwmax, AR_D_LCL_IFS_CWMAX) |
+		  SM(qi->tqi_aifs, AR_D_LCL_IFS_AIFS));
+
+	printk("regwrite aifs is %d\n",qi->tqi_aifs);
+
+	REG_WRITE(ah, AR_DRETRY_LIMIT(q),
+		  SM(INIT_SSH_RETRY, AR_D_RETRY_LIMIT_STA_SH) |
+		  SM(INIT_SLG_RETRY, AR_D_RETRY_LIMIT_STA_LG) |
+		  SM(qi->tqi_shretry, AR_D_RETRY_LIMIT_FR_SH));
+
+	REG_WRITE(ah, AR_QMISC(q), AR_Q_MISC_DCU_EARLY_TERM_REQ);
+
+	if (AR_SREV_9340(ah) && !AR_SREV_9340_13_OR_LATER(ah))
+		REG_WRITE(ah, AR_DMISC(q),
+			  AR_D_MISC_CW_BKOFF_EN | AR_D_MISC_FRAG_WAIT_EN | 0x1);
+	else
+		REG_WRITE(ah, AR_DMISC(q),
+			  AR_D_MISC_CW_BKOFF_EN | AR_D_MISC_FRAG_WAIT_EN | 0x2);
+
+	if (qi->tqi_cbrPeriod) {
+		REG_WRITE(ah, AR_QCBRCFG(q),
+			  SM(qi->tqi_cbrPeriod, AR_Q_CBRCFG_INTERVAL) |
+			  SM(qi->tqi_cbrOverflowLimit, AR_Q_CBRCFG_OVF_THRESH));
+		REG_SET_BIT(ah, AR_QMISC(q), AR_Q_MISC_FSP_CBR |
+			    (qi->tqi_cbrOverflowLimit ?
+			     AR_Q_MISC_CBR_EXP_CNTR_LIMIT_EN : 0));
+	}
+	if (qi->tqi_readyTime && (qi->tqi_type != ATH9K_TX_QUEUE_CAB)) {
+		REG_WRITE(ah, AR_QRDYTIMECFG(q),
+			  SM(qi->tqi_readyTime, AR_Q_RDYTIMECFG_DURATION) |
+			  AR_Q_RDYTIMECFG_EN);
+	}
+
+	REG_WRITE(ah, AR_DCHNTIME(q),
+		  SM(qi->tqi_burstTime, AR_D_CHNTIME_DUR) |
+		  (qi->tqi_burstTime ? AR_D_CHNTIME_EN : 0));
+
+	if (qi->tqi_burstTime
+	    && (qi->tqi_qflags & TXQ_FLAG_RDYTIME_EXP_POLICY_ENABLE))
+		REG_SET_BIT(ah, AR_QMISC(q), AR_Q_MISC_RDYTIME_EXP_POLICY);
+
+	if (qi->tqi_qflags & TXQ_FLAG_BACKOFF_DISABLE)
+		REG_SET_BIT(ah, AR_DMISC(q), AR_D_MISC_POST_FR_BKOFF_DIS);
+
+	REGWRITE_BUFFER_FLUSH(ah);
+
+	if (qi->tqi_qflags & TXQ_FLAG_FRAG_BURST_BACKOFF_ENABLE)
+		REG_SET_BIT(ah, AR_DMISC(q), AR_D_MISC_FRAG_BKOFF_EN);
+
+	switch (qi->tqi_type) {
+	case ATH9K_TX_QUEUE_BEACON:
+		ENABLE_REGWRITE_BUFFER(ah);
+
+		REG_SET_BIT(ah, AR_QMISC(q),
+			    AR_Q_MISC_FSP_DBA_GATED
+			    | AR_Q_MISC_BEACON_USE
+			    | AR_Q_MISC_CBR_INCR_DIS1);
+
+		REG_SET_BIT(ah, AR_DMISC(q),
+			    (AR_D_MISC_ARB_LOCKOUT_CNTRL_GLOBAL <<
+			     AR_D_MISC_ARB_LOCKOUT_CNTRL_S)
+			    | AR_D_MISC_BEACON_USE
+			    | AR_D_MISC_POST_FR_BKOFF_DIS);
+
+		REGWRITE_BUFFER_FLUSH(ah);
+
+		/*
+		 * cwmin and cwmax should be 0 for beacon queue
+		 * but not for IBSS as we would create an imbalance
+		 * on beaconing fairness for participating nodes.
+		 */
+		if (AR_SREV_9300_20_OR_LATER(ah) &&
+		    ah->opmode != NL80211_IFTYPE_ADHOC) {
+			REG_WRITE(ah, AR_DLCL_IFS(q), SM(0, AR_D_LCL_IFS_CWMIN)
+				  | SM(0, AR_D_LCL_IFS_CWMAX)
+				  | SM(qi->tqi_aifs, AR_D_LCL_IFS_AIFS));
+		}
+		break;
+	case ATH9K_TX_QUEUE_CAB:
+		ENABLE_REGWRITE_BUFFER(ah);
+
+		REG_SET_BIT(ah, AR_QMISC(q),
+			    AR_Q_MISC_FSP_DBA_GATED
+			    | AR_Q_MISC_CBR_INCR_DIS1
+			    | AR_Q_MISC_CBR_INCR_DIS0);
+		value = (qi->tqi_readyTime -
+			 (ah->config.sw_beacon_response_time -
+			  ah->config.dma_beacon_response_time)) * 1024;
+		REG_WRITE(ah, AR_QRDYTIMECFG(q),
+			  value | AR_Q_RDYTIMECFG_EN);
+		REG_SET_BIT(ah, AR_DMISC(q),
+			    (AR_D_MISC_ARB_LOCKOUT_CNTRL_GLOBAL <<
+			     AR_D_MISC_ARB_LOCKOUT_CNTRL_S));
+
+		REGWRITE_BUFFER_FLUSH(ah);
+
+		break;
+	case ATH9K_TX_QUEUE_PSPOLL:
+		REG_SET_BIT(ah, AR_QMISC(q), AR_Q_MISC_CBR_INCR_DIS1);
+		break;
+	case ATH9K_TX_QUEUE_UAPSD:
+		REG_SET_BIT(ah, AR_DMISC(q), AR_D_MISC_POST_FR_BKOFF_DIS);
+		break;
+	default:
+		break;
+	}
+
+	if (qi->tqi_intFlags & ATH9K_TXQ_USE_LOCKOUT_BKOFF_DIS) {
+		REG_SET_BIT(ah, AR_DMISC(q),
+			    SM(AR_D_MISC_ARB_LOCKOUT_CNTRL_GLOBAL,
+			       AR_D_MISC_ARB_LOCKOUT_CNTRL) |
+			    AR_D_MISC_POST_FR_BKOFF_DIS);
+	}
+
+	if (AR_SREV_9300_20_OR_LATER(ah))
+		REG_WRITE(ah, AR_Q_DESC_CRCCHK, AR_Q_DESC_CRCCHK_EN);
+
+	ath9k_hw_clear_queue_interrupts(ah, q);
+	if (qi->tqi_qflags & TXQ_FLAG_TXINT_ENABLE) {
+		ah->txok_interrupt_mask |= 1 << q;
+		ah->txerr_interrupt_mask |= 1 << q;
+	}
+	if (qi->tqi_qflags & TXQ_FLAG_TXDESCINT_ENABLE)
+		ah->txdesc_interrupt_mask |= 1 << q;
+	if (qi->tqi_qflags & TXQ_FLAG_TXEOLINT_ENABLE)
+		ah->txeol_interrupt_mask |= 1 << q;
+	if (qi->tqi_qflags & TXQ_FLAG_TXURNINT_ENABLE)
+		ah->txurn_interrupt_mask |= 1 << q;
+	ath9k_hw_set_txq_interrupts(ah, qi);
+
+	return true;
+}
+EXPORT_SYMBOL(ath9k_hw_resettxqueue_helper);
+
+
 int ath9k_hw_rxprocdesc(struct ath_hw *ah, struct ath_desc *ds,
 			struct ath_rx_status *rs)
 {
@@ -1046,3 +1220,4 @@
 	}
 }
 EXPORT_SYMBOL(ath9k_hw_set_tx_filter);
+
diff -ruN backports-5.3.6-1/drivers/net/wireless/ath/ath9k/mac.h backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/mac.h
--- backports-5.3.6-1/drivers/net/wireless/ath/ath9k/mac.h	2019-10-11 19:05:52.000000000 -0400
+++ backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/mac.h	2021-09-22 06:19:33.000000000 -0400
@@ -728,6 +728,7 @@
 			  const struct ath9k_tx_queue_info *qinfo);
 bool ath9k_hw_releasetxqueue(struct ath_hw *ah, u32 q);
 bool ath9k_hw_resettxqueue(struct ath_hw *ah, u32 q);
+bool ath9k_hw_resettxqueue_helper(struct ath_hw *ah, u32 q,int aifs);
 int ath9k_hw_rxprocdesc(struct ath_hw *ah, struct ath_desc *ds,
 			struct ath_rx_status *rs);
 void ath9k_hw_setuprxdesc(struct ath_hw *ah, struct ath_desc *ds,
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/mac.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/mac.o differ
diff -ruN backports-5.3.6-1/drivers/net/wireless/ath/ath9k/main.c backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/main.c
--- backports-5.3.6-1/drivers/net/wireless/ath/ath9k/main.c	2019-10-11 19:05:52.000000000 -0400
+++ backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/main.c	2021-09-21 04:10:24.000000000 -0400
@@ -447,6 +447,7 @@
 
 		ath_rx_tasklet(sc, 0, false);
 	}
+	ath_cabq_update(sc);
 
 	if (status & ATH9K_INT_TX) {
 		if (ah->caps.hw_caps & ATH9K_HW_CAP_EDMA) {
@@ -2705,3 +2706,4 @@
 	.get_txpower        = ath9k_get_txpower,
 	.wake_tx_queue      = ath9k_wake_tx_queue,
 };
+
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/main.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/main.o differ
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/wmi.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/wmi.o differ
diff -ruN backports-5.3.6-1/drivers/net/wireless/ath/ath9k/xmit.c backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/xmit.c
--- backports-5.3.6-1/drivers/net/wireless/ath/ath9k/xmit.c	2019-10-11 19:05:52.000000000 -0400
+++ backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/xmit.c	2021-09-22 06:20:52.000000000 -0400
@@ -46,6 +46,7 @@
 	{   234,  486 },     /*  6: 64-QAM 3/4 */
 	{   260,  540 },     /*  7: 64-QAM 5/6 */
 };
+long aifs;
 
 static void ath_tx_send_normal(struct ath_softc *sc, struct ath_txq *txq,
 			       struct ath_atx_tid *tid, struct sk_buff *skb);
@@ -1769,10 +1770,49 @@
 	int error = 0;
 	struct ath9k_tx_queue_info qi;
 
+	struct file *f;
+    char buf[64];
+	unsigned long count = 50;
+	int res;
+
+
 	BUG_ON(sc->tx.txq[qnum].axq_qnum != qnum);
 
 	ath9k_hw_get_txq_props(ah, qnum, &qi);
-	qi.tqi_aifs = qinfo->tqi_aifs;
+
+	f = filp_open("/proc/hello", O_RDONLY, 0);
+	if(IS_ERR(f)) {
+        printk("filp_open error!-xmit\n");
+	}
+    else{
+    	memset(buf,'\0',strlen(buf));
+		kernel_read(f,buf,count,&f->f_pos);
+        filp_close(f,NULL);	
+        if(buf != NULL){
+    		printk("buffer:%s\n",buf);
+    		
+			res = kstrtol(buf, 0, &aifs);
+			if(res == -EINVAL) {
+				printk("ERROR in parsing\n");
+			}
+			else if(res == -ERANGE) {
+				printk("ERROR overflow\n");
+			}
+		}
+		else{
+			printk("ERROR: NULL buffer\n");
+		}	
+    }
+
+    if(aifs>=0 && aifs<=255){
+    	qi.tqi_aifs = (int)aifs;
+    }
+    else{
+    	printk("wrong aifs range\n");
+    }
+
+    printk("new aifs in xmit: %d\n",qi.tqi_aifs);
+
 	qi.tqi_cwmin = qinfo->tqi_cwmin;
 	qi.tqi_cwmax = qinfo->tqi_cwmax;
 	qi.tqi_burstTime = qinfo->tqi_burstTime;
@@ -1783,7 +1823,7 @@
 			"Unable to update hardware queue %u!\n", qnum);
 		error = -EIO;
 	} else {
-		ath9k_hw_resettxqueue(ah, qnum);
+		ath9k_hw_resettxqueue_helper(ah, qnum,aifs);
 	}
 
 	return error;
@@ -2883,3 +2923,4 @@
 }
 
 #endif /* CPTCFG_ATH9K_TX99 */
+
Binary files backports-5.3.6-1/drivers/net/wireless/ath/ath9k/xmit.o and backports-5.3.6-1_AP_mod/drivers/net/wireless/ath/ath9k/xmit.o differ
diff -ruN backports-5.3.6-1/Module.symvers backports-5.3.6-1_AP_mod/Module.symvers
--- backports-5.3.6-1/Module.symvers	2021-03-24 03:17:10.000000000 -0400
+++ backports-5.3.6-1_AP_mod/Module.symvers	2021-09-22 06:21:52.000000000 -0400
@@ -194,6 +194,7 @@
 0x00000000	ieee80211_radar_detected	/root/backports-5.3.6-1/net/mac80211/mac80211	EXPORT_SYMBOL
 0x00000000	ath_regd_get_band_ctl	/root/backports-5.3.6-1/drivers/net/wireless/ath/ath	EXPORT_SYMBOL
 0x00000000	ath9k_cmn_debug_stat_rx	/root/backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k_common	EXPORT_SYMBOL
+0x00000000	ath9k_hw_resettxqueue_helper	/root/backports-5.3.6-1/drivers/net/wireless/ath/ath9k/ath9k_hw	EXPORT_SYMBOL
 0x00000000	ieee80211_rts_duration	/root/backports-5.3.6-1/net/mac80211/mac80211	EXPORT_SYMBOL
 0x00000000	ieee80211_ave_rssi	/root/backports-5.3.6-1/net/mac80211/mac80211	EXPORT_SYMBOL_GPL
 0x00000000	ieee80211_gtk_rekey_notify	/root/backports-5.3.6-1/net/mac80211/mac80211	EXPORT_SYMBOL_GPL
